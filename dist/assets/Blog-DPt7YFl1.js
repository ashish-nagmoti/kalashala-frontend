import{r as l,j as t,S as B,N as U,L as D}from"./index-BPVEKsek.js";import{a as T,e as R}from"./apiHelpers-DDwic4r0.js";const P=()=>{const[i,m]=l.useState([]),[u,r]=l.useState([]),[j,x]=l.useState(!0),[p,y]=l.useState(null),[g,N]=l.useState("all"),[f,v]=l.useState("all"),[w,C]=l.useState(["all"]),[S,k]=l.useState(["all"]);l.useEffect(()=>{(async()=>{try{x(!0);const n=await R("/blog/content/?exclude_course_content=true",{credentials:"include"});if(!n.ok)throw new Error(`Error: ${n.status}`);const s=await n.json();console.log("Fetched blog content:",s),console.log("Content types found:",[...new Set(s.map(a=>a.content_type))]);const o=s.filter(a=>a.content_type==="blog"),d=s.filter(a=>a.content_type==="video"),h=s.filter(a=>a.content_type==="pdf");console.log(`Found ${o.length} blogs, ${d.length} videos, ${h.length} pdfs/documents`),d.length>0&&console.log("Sample video item:",d[0]),h.length>0&&console.log("Sample pdf item:",h[0]),s.forEach(a=>{console.log(`Content ${a.id} (${a.content_type}): thumbnail=${a.thumbnail}`)});const c=Array.isArray(s)?s:[];m(c),r(c);const F=["all",...new Set(c.map(a=>a.category).filter(Boolean))],E=["all",...new Set(c.map(a=>a.content_type).filter(Boolean))];C(F),k(E)}catch(n){y(n.message),console.error("Failed to fetch content:",n),m([]),r([])}finally{x(!1)}})()},[]);const A=e=>{if(!e){r(i);return}const n=i.filter(s=>s.title.toLowerCase().includes(e.toLowerCase())||s.description.toLowerCase().includes(e.toLowerCase())||s.tags&&s.tags.toLowerCase().includes(e.toLowerCase()));r(n)},L=e=>{N(e),b(e,f)},_=e=>{v(e),b(g,e)},b=(e,n)=>{let s=i;e!=="all"&&(s=s.filter(o=>o.category===e)),n!=="all"&&(s=s.filter(o=>o.content_type===n)),r(s)},$=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return t.jsx("div",{className:"py-8",children:t.jsxs("div",{className:"container-custom",children:[t.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Content Repository"}),t.jsx("p",{className:"text-gray-600 mb-8",children:"Access our collection of resources, documentation, and research materials for traditional crafts and techniques."}),t.jsx("div",{className:"mb-8",children:t.jsx(B,{placeholder:"Search resources...",onSearch:A})}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[t.jsxs("div",{className:"md:w-1/4",children:[t.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[t.jsx("h2",{className:"font-semibold text-lg mb-4",children:"Categories"}),t.jsx("div",{className:"space-y-2",children:w.map((e,n)=>t.jsx("button",{onClick:()=>L(e),className:`block w-full text-left px-3 py-2 rounded-md ${g===e?"bg-black text-white":"hover:bg-gray-100"}`,children:e==="all"?"All Categories":e},n))})]}),t.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm mt-6",children:[t.jsx("h2",{className:"font-semibold text-lg mb-4",children:"Content Types"}),t.jsx("div",{className:"space-y-2",children:S.map((e,n)=>t.jsx("button",{onClick:()=>_(e),className:`block w-full text-left px-3 py-2 rounded-md ${f===e?"bg-black text-white":"hover:bg-gray-100"}`,children:e==="all"?"All Types":e},n))})]}),t.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm mt-6",children:[t.jsx("h2",{className:"font-semibold text-lg mb-4",children:"Contribute"}),t.jsx(U,{to:"/content-create",className:"btn-primary w-full block text-center",children:"Create New Content"})]})]}),t.jsx("div",{className:"md:w-3/4",children:j?t.jsx("div",{className:"flex justify-center items-center py-20",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-black"})}):p?t.jsxs("div",{className:"bg-red-50 text-red-600 p-4 rounded-lg",children:[t.jsx("p",{children:p}),t.jsx("p",{children:"Please try again later or contact support if the issue persists."})]}):u.length===0?t.jsx("div",{className:"text-center py-12 bg-white rounded-lg",children:t.jsx("p",{className:"text-gray-500",children:"No resources found matching your criteria."})}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:u.map(e=>t.jsxs(D,{to:`/blog/${e.id}`,className:"card group",children:[t.jsxs("div",{className:"aspect-video overflow-hidden relative",children:[t.jsx("img",{src:e.thumbnail?e.thumbnail.startsWith("http")?e.thumbnail:T(e.thumbnail.startsWith("/media")?e.thumbnail:`/media/${e.thumbnail}`):"/placeholder.svg",alt:e.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}),t.jsx("div",{className:"absolute top-2 right-2 bg-black text-white text-xs px-2 py-1 rounded",children:e.content_type})]}),t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-center text-xs text-gray-500 mb-2",children:[t.jsx("span",{children:$(e.upload_date)}),t.jsx("span",{className:"mx-2",children:"â€¢"}),t.jsx("span",{children:e.category})]}),t.jsx("h3",{className:"font-semibold text-lg mb-2 group-hover:text-accent transition-colors",children:e.title}),t.jsx("p",{className:"text-gray-600 text-sm mb-4",children:e.description}),t.jsx("div",{className:"flex items-center",children:e.contributor?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 mr-3 flex items-center justify-center",children:e.contributor.name?e.contributor.name.charAt(0).toUpperCase():e.contributor.username?e.contributor.username.charAt(0).toUpperCase():"A"}),t.jsx("span",{className:"text-sm font-medium",children:e.contributor.name||e.contributor.username||"Anonymous"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 mr-3"}),t.jsx("span",{className:"text-sm font-medium",children:"Anonymous"})]})})]})]},e.id))})})]})]})})};export{P as default};
